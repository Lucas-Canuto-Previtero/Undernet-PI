<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="assets/icon/iconCellphone.ico">
    <title>Undernet - Corrida de Lesmas</title>

    <link rel="stylesheet" href="css/style.css">
</head>


<body class="bodyCorrida">
    <div class="header">
        <div class="container">
            <img src="assets/img/logoSITE.png" alt="">
            <ul class="navbar">

                <a href="index-logado.html">Home</a>
                <li> | </li>
                <a href="sobre-logado.html">Sobre o site</a>
                <li> | </li>
                <a href="forum.html">F√≥rum</a>
                <li> | </li>
                <a style="color: yellow;" href="minigames.html">Minigames</a>
                <li> | </li>
                <a style="color: red;" href="https://deltarune.com">Deltarune</a>
            </ul>


            <div class="hello">
                <a href="usuario.html">
                    <div id="fotoPerfil"></div>
                </a>
                <a href="usuario.html">
                    <span id="b_usuario">usu√°rio</span>
                </a>
            </div>
        </div>
    </div>


    <br><br>
    <br><br>
    <br><br>

    <div class="bemVindo">
        <h1 style="font-size: 50px;">Bem-vindo(a) √† <br> üî•ThunderSnailüî•<br>A corrida de lesmas do napstablook!</h1>
        <h1>Clique no bot√£o 'Come√ßar' abaixo da pista para inicar a corrida. A diferen√ßa daqui para o jogo, √© que aqui
            voc√™ realmente
            tem que clicar o bot√£o Z o mais r√°pido poss√≠vel! <br> No final, ser√° exibido o seu resultado de CPS e sua
            posi√ß√£o no ranking de jogadores! <br>Boa sorte, corredor!</h1>
    </div>

    <div class="mainCorrida">
        <div id="div_contagem"></div>
        <div class="pista">
            <img id="caracol" src="/assets/img/caracol.png" alt="">
        </div>
    </div>

    <button onclick="iniciarCorrida()" class="btnCorrida">Come√ßar</button>





    <div class="footer">
        <img src="/assets/img/logoSITE.png" alt="">

        <ul class="footerPages">
            <li><a href="index-logado.html">Home</a></li>


            <li><a href="sobre-logado.html">Sobre o site</a></li>


            <li><a href="forum.html">F√≥rum</a></li>


            <li><a href="minigames.html">Minigames</a></li>


            <li><a href="https://deltarune.com">Deltarune</a></li>

        </ul>

        <div class="infoCredits">
            <h2>Email:</h2>
            <h3>lucas.previtero@sptech.school</h3>
            <h2>Cr√©ditos:</h2>
            <h3>Lucas Canuto Previtero (Criador do site UNDERNET)</h3>
            <a href="https://github.com/jcw87">
                <h3>Jcw87 (Criador do minigame Bad Time Simulator)</h3>
            </a>
            <h3>Toby Fox e Temmie Chang (Criadores de Undertale)</h3>
        </div>
    </div>
</body>

</html>

<script>
    var foto_usuario = sessionStorage.FOTO_PERFIL;
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    fotoPerfil.innerHTML = `<img src="${foto_usuario}" style=" object-fit: cover; border-radius: 15px; border: white solid 3px;">`;


    var contagem = 3;
    var distancia = 0;
    var valendo = false;
    var tempoTotal = 9;
    var cliques = 0;
    var tempoFinal;
    var CPS;


    function iniciarCorrida() {
        contagemIniciar();
    }


    function contagemIniciar() {
        if (contagem > 0) {
            div_contagem.innerHTML = `<h1>${contagem}</h1>`
            contagem--;
            setTimeout(() => contagemIniciar(), 1000);

        } else if (contagem == 0) {
            contagem = 'VAI!';
            div_contagem.innerHTML = `<h1>${contagem}</h1>`
            valendo = true;

            if (valendo = true) {
                somarMargem();
                setTimeout(() => contagemRegressiva(), 1000);

                function contagemRegressiva() {
                    contarR();
                }

                function contarR() {
                    if (tempoTotal > 0) {
                        div_contagem.innerHTML = `<h1>${tempoTotal}</h1>`
                        tempoTotal--;
                        setTimeout(() => contarR(), 1000);
                    } else if (tempoTotal == 0) {
                        tempoFinal = 10;
                        tempoTotal = 'Acabou o tempo!';
                        div_contagem.innerHTML = `<h1 style="color: red">${tempoTotal}</h1>`
                        return tempoFinal, CPS = cliques / tempoFinal, salvarResultado();
                    }
                }




                function andarCaracol() {
                    var caracol = document.getElementById("caracol");
                    caracol.style.marginRight = `${distancia}%`;
                }

                function somarMargem() {
                    document.addEventListener('keyup', function (event) {

                        if (tempoTotal >= -1) {
                            if (distancia >= 95) {
                                tempoFinal = 9 - tempoTotal;
                                tempoTotal = "Voc√™ venceu!";
                                div_contagem.innerHTML = `<h1 style="color: green">${tempoTotal}</h1>`
                                return tempoFinal, CPS = cliques / tempoFinal, salvarResultado();
                            }
                            if (event.key == 'z') {
                                distancia += 0.85;
                                cliques++;
                                andarCaracol();
                                return;
                            }
                        }
                    });
                }
            }
        }
    }

    var tempoCorrida = 0;

    function atualizartempoCorrida() {
        tempoCorrida = 0;
        tempoCorrida++;
        return tempoCorrida;
    }
    setInterval(atualizartempoCorrida, 1000);



    function salvarResultado() {
        const idUsuario = sessionStorage.ID_USUARIO;

        fetch("/corrida/registrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                idUsuario: idUsuario,
                tempoCorrida: tempoCorrida,
                CPS: CPS
            })
        })
            .then(res => res.text())
            .then(msg => {
                console.log(msg);
            })
            .catch(err => {
                console.error("Erro ao realizar o envio:", err);
            });
    }









    //  function atualizarFeed() {
    //         fetch("/forum/listar").then(function (resposta) {
    //             if (resposta.ok) {
    //                 if (resposta.status == 204) {
    //                     var feed = document.getElementById("feed_container");
    //                     var mensagem = document.createElement("span");
    //                     mensagem.innerHTML = "Nenhum resultado encontrado."
    //                     feed.appendChild(mensagem);
    //                     throw "Nenhum resultado encontrado!!";
    //                 }

    //                 resposta.json().then(function (resposta) {
    //                     console.log("Dados recebidos: ", JSON.stringify(resposta));

    //                     var feed = document.getElementById("feed_container");
    //                     feed.innerHTML = "";
    //                     for (let i = 0; i < resposta.length; i++) {
    //                         var publicacao = resposta[i];

    //                         // criando e manipulando elementos do HTML via JavaScript
    //                         var divPublicacao = document.createElement("div");
    //                         var divFotoContent = document.createElement("div");
    //                         var divDadosPubli = document.createElement("div")
    //                         var divfotoPerfil = document.createElement("div");
    //                         var spanData = document.createElement("span");
    //                         var spanNome = document.createElement("span");
    //                         var spanTipo = document.createElement("span");
    //                         var divDescricao = document.createElement("div");
    //                         var divpostImg = document.createElement("div")
    //                         var divButtons = document.createElement("div");
    //                         var btnEditar = document.createElement("button");
    //                         var btnDeletar = document.createElement("button");

    //                         divPublicacao.className = "publicacao";
    //                         divFotoContent.className = "FotoContent";
    //                         divDadosPubli.className = "dadosPubli";

    //                         divfotoPerfil.innerHTML = `<img src="${publicacao.fotoPerfil}">`;
    //                         spanData.innerHTML = "<b>Data: </b>" + publicacao.dataHora_Formatada + "<br>";
    //                         spanNome.innerHTML = "<b>Autor: </b>" + publicacao.nome + "<br>";
    //                         spanTipo.innerHTML = `${publicacao.tipoPostagem}<br>`;
    //                         divDescricao.innerHTML = "<b>Descri√ß√£o: </b>" + publicacao.descricao + "<br>";


    //                         divpostImg.innerHTML = `<img src="${publicacao.imagem}">`;


    //                         btnEditar.innerHTML = "Editar";
    //                         btnDeletar.innerHTML = "Deletar";

    //                         divfotoPerfil.className = "publicacao-imgPerfil";
    //                         spanNome.className = "publicacao-nome";
    //                         divDescricao.className = "publicacao-descricao";
    //                         divpostImg.className = "publicacao-img";
    //                         spanTipo.className = "publicacao-tipo";

    //                         divButtons.className = "div-buttons"

    //                         btnEditar.className = "publicacao-btn-editar"
    //                         btnEditar.id = "btnEditar" + publicacao.idPostagem;
    //                         btnEditar.setAttribute("onclick", `editar(${publicacao.idPostagem})`);

    //                         btnDeletar.className = "publicacao-btn-editar"
    //                         btnDeletar.id = "btnDeletar" + publicacao.idPostagem;
    //                         btnDeletar.setAttribute("onclick", `deletar(${publicacao.idPostagem})`);

    //                         divPublicacao.appendChild(divFotoContent);
    //                         divFotoContent.appendChild(divfotoPerfil);
    //                         divFotoContent.appendChild(divDadosPubli);
    //                         divDadosPubli.appendChild(spanData);
    //                         divDadosPubli.appendChild(spanNome);
    //                         divPublicacao.appendChild(spanTipo);
    //                         divDadosPubli.appendChild(divDescricao);
    //                         divDadosPubli.appendChild(divpostImg);
    //                         divDadosPubli.appendChild(divButtons);


    //                         feed.appendChild(divPublicacao);
    //                     }

    //                     finalizarAguardar();
    //                 });
    //             } else {
    //                 throw ('Houve um erro na API!');
    //             }
    //         }).catch(function (resposta) {
    //             console.error(resposta);
    //             finalizarAguardar();
    //         });
    //     }











</script>